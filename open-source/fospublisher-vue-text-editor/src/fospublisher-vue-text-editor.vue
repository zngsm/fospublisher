<template>
  <body :style="styleObject.editorWidth" class="editorWidth">
    <div class=".toolBar">
      <button
        :style="styleObject.toolButton"
        class="toolButton"
        @click="execCmd('bold')"
      >
        <i class="fas fa-bold"></i>
        <span :style="styleObject.tooltip" class="tooltip">êµµê²Œ</span>
      </button>
      <button
        :style="styleObject.toolButton"
        class="toolButton"
        @click="execCmd('italic')"
      >
        <i class="fas fa-italic"></i>
        <span :style="styleObject.tooltip" class="tooltip">ê¸°ìš¸ì„ê¼´</span>
      </button>
      <button
        :style="styleObject.toolButton"
        class="toolButton"
        @click="execCmd('underline')"
      >
        <i class="fas fa-underline"></i>
        <span :style="styleObject.tooltip" class="tooltip">ë°‘ì¤„</span>
      </button>
      <button
        :style="styleObject.toolButton"
        class="toolButton"
        @click="execCmd('strikethrough')"
      >
        <i class="fas fa-strikethrough"></i>
        <span :style="styleObject.tooltip" class="tooltip">ì·¨ì†Œì„ </span>
      </button>
      <button
        :style="styleObject.toolButton"
        class="toolButton"
        @click="execCmd('justifyLeft')"
      >
        <i class="fas fa-align-left"></i>
        <span :style="styleObject.tooltip" class="tooltip">ì™¼ìª½ ì •ë ¬</span>
      </button>
      <button
        :style="styleObject.toolButton"
        class="toolButton"
        @click="execCmd('justifyCenter')"
      >
        <i class="fas fa-align-center"></i>
        <span :style="styleObject.tooltip" class="tooltip">ê°€ìš´ë° ì •ë ¬</span>
      </button>
      <button
        :style="styleObject.toolButton"
        class="toolButton"
        @click="execCmd('justifyRight')"
      >
        <i class="fas fa-align-right"></i>
        <span :style="styleObject.tooltip" class="tooltip">ì˜¤ë¥¸ìª½ ì •ë ¬</span>
      </button>
      <button
        :style="styleObject.toolButton"
        class="toolButton"
        @click="execCmd('justifyFull')"
      >
        <i class="fas fa-align-justify"></i>
        <span :style="styleObject.tooltip" class="tooltip">ì–‘ìª½ ë§ì¶¤</span>
      </button>
      <button
        :style="styleObject.toolButton"
        class="toolButton"
        @click="execCmd('cut')"
      >
        <i class="fas fa-cut"></i>
        <span :style="styleObject.tooltip" class="tooltip">ì˜ë¼ë‚´ê¸°</span>
      </button>
      <button
        :style="styleObject.toolButton"
        class="toolButton"
        @click="execCmd('copy')"
      >
        <i class="fas fa-copy"></i>
        <span :style="styleObject.tooltip" class="tooltip">ë³µì‚¬í•˜ê¸°</span>
      </button>
      <button
        :style="styleObject.toolButton"
        class="toolButton"
        @click="execCmd('indent')"
      >
        <i class="fas fa-indent"></i>
        <span :style="styleObject.tooltip" class="tooltip">ë“¤ì—¬ì“°ê¸°</span>
      </button>
      <button
        :style="styleObject.toolButton"
        class="toolButton"
        @click="execCmd('outdent')"
      >
        <i class="fas fa-outdent"></i>
        <span :style="styleObject.tooltip" class="tooltip">ë‚´ì–´ì“°ê¸°</span>
      </button>
      <button
        :style="styleObject.toolButton"
        class="toolButton"
        @click="execCmd('subscript')"
      >
        <i class="fas fa-subscript"></i>
        <span :style="styleObject.tooltip" class="tooltip">ì•„ë˜ ì²¨ì</span>
      </button>
      <button
        :style="styleObject.toolButton"
        class="toolButton"
        @click="execCmd('superscript')"
      >
        <i class="fas fa-superscript"></i>
        <span :style="styleObject.tooltip" class="tooltip">ìœ„ ì²¨ì</span>
      </button>
      <button
        :style="styleObject.toolButton"
        class="toolButton"
        @click="execCmd('undo')"
      >
        <i class="fas fa-undo"></i>
        <span :style="styleObject.tooltip" class="tooltip">ì·¨ì†Œ</span>
      </button>
      <button
        :style="styleObject.toolButton"
        class="toolButton"
        @click="execCmd('redo')"
      >
        <i class="fas fa-redo"></i>
        <span :style="styleObject.tooltip" class="tooltip">ë‹¤ì‹œ ì‹¤í–‰</span>
      </button>
      <button
        :style="styleObject.toolButton"
        class="toolButton"
        @click="execCmd('insertUnorderedList')"
      >
        <i class="fas fa-list-ul"></i>
        <span :style="styleObject.tooltip" class="tooltip">ê¸€ë¨¸ë¦¬ ê¸°í˜¸</span>
      </button>
      <button
        :style="styleObject.toolButton"
        class="toolButton"
        @click="execCmd('insertOrderedList')"
      >
        <i class="fas fa-list-ol"></i>
        <span :style="styleObject.tooltip" class="tooltip">ë²ˆí˜¸ ë§¤ê¸°ê¸°</span>
      </button>
      <button
        :style="styleObject.toolButton"
        class="toolButton"
        @click="execCmd('insertParagraph')"
      >
        <i class="fas fa-paragraph"></i>
        <span :style="styleObject.tooltip" class="tooltip">ì¤„ë°”ê¿ˆ</span>
      </button>
      <button
        :style="styleObject.toolButton"
        class="toolButton"
        @click="execCmd('insertHorizontalRule')"
      >
        HR
        <span :style="styleObject.tooltip" class="tooltip">ê°€ë¡œì„ </span>
      </button>

      <button
        :style="styleObject.toolButton"
        class="toolButton"
        @click="toggleLinkModal"
      >
        <i class="fas fa-link"></i>
        <span :style="styleObject.tooltip" class="tooltip">ë§í¬</span>
      </button>

      <div id="linkModal" class="modal">
        <div :style="styleObject.modalContent" class="modal-content">
          <h2 style="margin-top: 0">Link</h2>
          <input
            :style="styleObject.modalTextInput"
            v-model="pageLink"
            class="modalTextInput"
            type="text"
          />
          <button
            :style="styleObject.modalButton"
            class="modalButton"
            @click="toggleLinkModal"
          >
            OKAY
          </button>
        </div>
      </div>

      <button
        :style="styleObject.toolButton"
        id="emoji-trigger"
        class="toolButton"
      >
        ğŸ˜€
        <span :style="styleObject.tooltip" class="tooltip">ì´ëª¨í‹°ì½˜</span>
      </button>
      <div class="dropdown">
        <button
          @click="toggleDropdown('fontStyleDropdown')"
          class="dropdownButton"
          :style="styleObject.dropdownButton"
        >
          FONT STYLE â–¾
          <span :style="styleObject.tooltip" class="tooltip">ê¸€ê¼´</span>
        </button>
        <div
          id="fontStyleDropdown"
          style="width: 110px"
          class="dropdown-content"
        >
          <div
            v-for="(font, index) in fontStyle"
            :key="index"
            :style="{ 'font-family': [font] }"
            @click="
              [
                execCommandWithArg('fontName', font),
                toggleDropdown('fontStyleDropdown'),
              ]
            "
          >
            {{ font }}
          </div>
        </div>
      </div>
      <div class="dropdown">
        <button
          @click="toggleDropdown('fontSizeDropdown')"
          class="dropdownButton"
          :style="styleObject.dropdownButton"
        >
          FONT SIZE â–¾
          <span :style="styleObject.tooltip" class="tooltip">ê¸€ì”¨ í¬ê¸°</span>
        </button>
        <div id="fontSizeDropdown" style="width: 97px" class="dropdown-content">
          <div
            v-for="(size, index) in fontSize"
            :key="index"
            @click="
              [
                execCommandWithArg('formatBlock', size),
                toggleDropdown('fontSizeDropdown'),
              ]
            "
          >
            {{ size }}
          </div>
        </div>
      </div>
      <div style="display: inline-block;">
        <div :style="styleObject.colorPickerButton" class="colorPickerButton">FONT COLOR</div>
        <button :style="styleObject.toolButtonText" class="toolButtonText">
          <input
            class="colorPicker"
            type="color"
            @change="execCommandWithArg('foreColor', $event.target.value)"
          />
          <span :style="styleObject.tooltip" class="tooltip">ê¸€ì”¨ ìƒ‰</span>
        </button>
      </div>
      <div style="display: inline-block;">
        <div :style="styleObject.colorPickerButton" class="colorPickerButton">BACKGROUND COLOR</div>
        <button :style="styleObject.toolButtonText" class="toolButtonText">
          <input
            class="colorPicker"
            type="color"
            @change="execCommandWithArg('hiliteColor', $event.target.value)"
          />
          <span :style="styleObject.tooltip" class="tooltip">ê¸€ê¼´ ë°°ê²½ìƒ‰</span>
        </button>
      </div>

      <button
        :style="styleObject.toolButtonText"
        class="toolButtonText"
        @click="toggleImageModal"
      >
        <i class="fas fa-file-image"></i> IMAGE
        <span :style="styleObject.tooltip" class="tooltip">ì´ë¯¸ì§€ ì‚½ì…</span>
      </button>

      <div id="imageModal" class="modal">
        <div :style="styleObject.modalContent" class="modal-content">
          <h2 style="margin-top: 0">Image upload</h2>
          <input
            :style="styleObject.modalTextInput"
            class="modalTextInput"
            id="ImageFile"
            type="file"
            accept="image/png, image/jpeg"
          />
          <div style="font-size: 15px; padding-bottom: 5px">Image link</div>
          <input
            :style="styleObject.modalTextInput"
            v-model="imageLink"
            class="modalTextInput"
            type="text"
          />
          <button
            :style="styleObject.modalButton"
            class="modalButton"
            @click="toggleImageModal"
          >
            OKAY
          </button>
        </div>
      </div>

      <button
        :style="styleObject.toolButtonText"
        class="toolButtonText"
        @click="execCmd('selectAll')"
      >
        SELECT ALL
        <span :style="styleObject.tooltip" class="tooltip">ì „ë¶€ ì„ íƒ</span>
      </button>
      <button
        :style="styleObject.toolButtonText"
        class="toolButtonText"
        @click="exportToPDF()"
      >
        <i class="fas fa-file-pdf"></i> PDF
        <span :style="styleObject.tooltip" class="tooltip">PDF ì¶”ì¶œ</span>
      </button>
    </div>

    <iframe
      :style="styleObject.editorWidth"
      id="richTextField"
      name="richTextField"
      class="editorWidth"
    ></iframe>
  </body>
</template>

<script>
import { EmojiButton } from "@joeattardi/emoji-button";
import html2pdf from "html2pdf.js";
import jquery from "jquery";
import "@fortawesome/fontawesome-free/js/all.js";

require( "jquery-ui/ui/widgets/draggable" );
require("jquery");
require("jquery-ui-bundle");

export default {
  props: {
    styleObject: Object,
    content: String,
  },
  data() {
    return {
      isInEditMode: true,
      fontSize: ["H1", "H2", "H3", "H4", "H5", "H6"],
      fontStyle: ["ë‹ì›€", "êµ´ë¦¼", "ë°”íƒ•", "ê¶ì„œ", "ë§‘ì€ ê³ ë”•"],
      // fontStyle: ['Arial', 'Comic Sans MS', 'Courier', 'Georgia', 'Tahoma', 'Times New Roman', 'Verdana'],
      imageFile: [],
      imageLink: "",
      imageNum: 0,
      pageLink: "",
      pagination: 1,
    };
  },
  methods: {
    // JH
    // ëª…ë ¹ ì‚½ì… í›„ ìë™ìœ¼ë¡œ ë‹¤ìŒ ì»¤ì„œë¡œ ì´ë™
    setFocus() {
      const iFrame = document.getElementsByName("richTextField");
      jquery(iFrame).contents().find("body").focus();
    },
    toggleImageModal() {
      const modal = document.getElementById("imageModal");
      if (modal.style.display == "block") {
        modal.style.display = "none";
        const imageFile = document.getElementById("ImageFile").value;
        if (this.imageLink != "" || imageFile) {
          this.insertImage();
        }
      } else {
        modal.style.display = "block";
      }
    },
    toggleLinkModal() {
      const modal = document.getElementById("linkModal");
      if (modal.style.display == "block") {
        modal.style.display = "none";
        if (this.pageLink != "") {
          this.insertLink();
        }
      } else {
        modal.style.display = "block";
      }
    },
    toggleDropdown(arg) {
      document.getElementById(arg).classList.toggle("show");
    },
    pageBreak() {
      // ì—ë””í„° ì•ˆì— ë“¤ì–´ìˆëŠ” íƒœê·¸ ëª¨ë‘ ê°€ì ¸ì˜¤ê¸°
      const childNodes = jquery('iframe[name="richTextField"]')
        .contents()
        .find("body")[0].childNodes;
      const vm = this;
      childNodes.forEach(function (childNode) {
        // ê° íƒœê·¸ì˜ yì¶• ì‹œì‘ ìœ„ì¹˜ëŠ” childNode.offsetTop
        // pagination 1ë¶€í„° ì‹œì‘, 500pxë§ˆë‹¤ í˜ì´ì§€ ë¶„ì ˆí•˜ëŠ” ê²ƒìœ¼ë¡œ ì„¤ì •
        if (childNode.offsetTop > vm.pagination * 500) {
          // class="html2pdf__page-break" <-- htmlpdf ëª¨ë“ˆì—ì„œ í˜ì´ì§€ ë¶„ì ˆ ê¸°ëŠ¥ì„ ë‹´ë‹¹í•˜ëŠ” class
          // 500pxë§ˆë‹¤ í•´ë‹¹ classë¥¼ ë‹´ì€ divë¥¼ ì‚½ì…í•œë‹¤
          jquery(`<br>
            <div class="html2pdf__page-break" style="border-bottom: 1px dashed black; position: relative;">
              <div style="-webkit-transform: translate(-50%,-50%); 
                transform: translate(-50%,-50%);
                position: absolute; 
                background-color: white;
                border: 1px solid black;
                border-radius: 3px;
                top: 50%;  
                left: 50%;
                padding: 2px 10px;
                justify-content: center;"
              >
                PAGE ${vm.pagination}
              </div>
            </div>
            <br>`).insertBefore(childNode);
          vm.pagination += 1;
        }
      });
    },
    // ì´ë¯¸ì§€ ì‚½ì… í›„ ë“œë˜ê·¸ ë° ë¦¬ì‚¬ì´ì¦ˆ ê¸°ëŠ¥ ì¶”ê°€ í•¨ìˆ˜
    imageDragResize() {
      const vm = this;
      jquery('iframe[name="richTextField"]')
        .contents()
        .find(`#${vm.imageNum}`)
        .wrap(
          `<div id="draggableHelper${vm.imageNum}" contenteditable="false" style="display:inline-block"></div>`
        );
      // ì´ë¯¸ì§€ ìœ„ ì•„ë˜ë¡œ ë¹ˆ ì¹¸ ì¶”ê°€
      jquery('iframe[name="richTextField"]')
        .contents()
        .find(`#draggableHelper${vm.imageNum}`)
        .after("<br>");
      jquery('iframe[name="richTextField"]')
        .contents()
        .find(`#draggableHelper${vm.imageNum}`)
        .before("<br>");

      // xì¶• ë°©í–¥ìœ¼ë¡œë§Œ ì´ë¯¸ì§€ ë“œë˜ê·¸ ê°€ëŠ¥, richtextField ë‚´ì—ì„œë§Œ ì›€ì§ì¼ ìˆ˜ ìˆìŒ
      jquery('iframe[name="richTextField"]')
        .contents()
        .find(`#draggableHelper${vm.imageNum}`)
        .draggable({
          containment: window.richTextField.document.getElementsByTagName(
            "body"
          ),
          scroll: true,
          scrollSensitivity: 100,
          scrollSpeed: 100,
          // xì¶• yì¶• ë‘˜ ë‹¤ ê°€ëŠ¥(axis ì†ì„± ì œì™¸)
          // axis: "x",
        });

      // ë¦¬ì‚¬ì´ì¦ˆ ê¸°ëŠ¥ì„ ìœ„í•œ ìŠ¤íƒ€ì¼ë§ ì ìš©(ifram ë‚´ë¶€ ê°ì²´ëŠ” style íƒœê·¸ ì•ˆì—ì„œ cssì§ì ‘ì ìœ¼ë¡œ ìˆ˜ì • ë¶ˆê°€)
      // ë¦¬ì‚¬ì´ì¦ˆ í•¸ë“¤ëŸ¬ css
      jquery('iframe[name="richTextField"]')
        .contents()
        .find(`#${vm.imageNum}`)
        .resizable({ aspectRatio: true, minWidth: 300 });
      jquery('iframe[name="richTextField"]')
        .contents()
        .find(`#draggableHelper${vm.imageNum} > .ui-wrapper`)
        .children(".ui-resizable-handle")
        .css({
          position: "absolute",
          "font-size": "0.1px",
          display: "block",
          "-ms-touch-action": "none",
          "touch-action": "none",
        });
      jquery('iframe[name="richTextField"]')
        .contents()
        .find(`#draggableHelper${vm.imageNum} > .ui-wrapper`)
        .children(".ui-resizable-e")
        .css({
          cursor: "e-resize",
          width: "7px",
          right: "-5px",
          top: "0",
          height: "100%",
        });
      jquery('iframe[name="richTextField"]')
        .contents()
        .find(`#draggableHelper${vm.imageNum} > .ui-wrapper`)
        .children(".ui-resizable-s")
        .css({
          cursor: "s-resize",
          height: "7px",
          bottom: "-5px",
          left: "0",
          width: "100%",
        });
      jquery('iframe[name="richTextField"]')
        .contents()
        .find(`#draggableHelper${vm.imageNum} > .ui-wrapper`)
        .children(".ui-resizable-se")
        .css({
          cursor: "se-resize",
          height: "12px",
          bottom: "1px",
          right: "1px",
          width: "12px",
        });
      jquery('iframe[name="richTextField"]')
        .contents()
        .find(`#${vm.imageNum}`)
        .mouseenter(function (event) {
          event.target.style.cursor = "pointer";
          event.target.style.border = "solid grey 1px";
          event.target.style.boxSizing = "border-box";
        });
      jquery('iframe[name="richTextField"]')
        .contents()
        .find(`#${vm.imageNum}`)
        .mouseout(function (event) {
          event.target.style.border = "none";
        });
      vm.imageNum += 1;
    },
    insertLink() {
      this.execCommandWithArg("createLink", this.pageLink);
      const links = window.richTextField.document.querySelectorAll("a");
      links.forEach((item) => {
        item.target = "_blank";
        // ë§í¬ ì‚½ì… í›„ í´ë¦­í•˜ë©´ ë§í¬ë¡œ ì´ë™í•  ìˆ˜ ìˆë„ë¡ ë””ìì¸ ëª¨ë“œ ë”
        item.addEventListener("mouseover", () => {
          window.richTextField.document.designMode = "Off";
        });
        // ë§í¬ ì‚½ì… í›„ ë‹¤ë¥¸ ì‘ì—…ì´ ê°€ëŠ¥í•˜ë„ë¡ ë””ìì¸ ëª¨ë“œ ë‹¤ì‹œ í‚´
        item.addEventListener("mouseout", () => {
          window.richTextField.document.designMode = "On";
        });
      });
      this.pageLink = "";
    },
    insertImage() {
      const imageFile = document.getElementById("ImageFile").files[0];
      // ë¡œì»¬ì—ì„œ ì´ë¯¸ì§€ë¥¼ ì§ì ‘ ì˜¬ë¦¬ëŠ” ê²½ìš°
      this.setFocus();
      if (imageFile) {
        const vm = this;
        const file = imageFile;
        const reader = new FileReader();
        const image = new Image();
        reader.readAsDataURL(file);
        reader.onloadend = function () {
          image.src = reader.result;
        };
        setTimeout(() => {
          this.execCommandWithArg("insertImage", image.src);
        }, 100);
        setTimeout(() => {
          const imgTags = $('iframe[name="richTextField"]')
            .contents()
            .find("img");
          imgTags.each(function (index, imgTag) {
            if (imgTag.id == "") {
              imgTag.setAttribute("id", vm.imageNum);
              imgTag.style.maxWidth = 700;
              imgTag.onload = function () {
                vm.imageDragResize();
              };
              document.getElementById("ImageFile").value = "";
            }
          });
        }, 100);

        // ì´ë¯¸ì§€ ë§í¬ë¡œ ì˜¬ë¦¬ëŠ” ê²½ìš°
      } else if (this.imageLink != "") {
        this.execCommandWithArg("insertImage", this.imageLink);
        const vm = this;
        const imgTags = jquery('iframe[name="richTextField"]')
          .contents()
          .find("img");
        imgTags.each(function (index, imgTag) {
          if (imgTag.id == "") {
            imgTag.setAttribute("id", vm.imageNum);
            imgTag.style.maxWidth = 700;
            imgTag.onload = function () {
              vm.imageDragResize();
            };
          }
        });
        this.imageLink = "";
      }
    },
    execCmd(command) {
      // ì¸ìê°€ í•„ìš”ì—†ëŠ” ëª…ë ¹ì–´ì¸ ê²½ìš°
      // ex. ê¸€ì”¨ êµµê²Œ í•˜ê¸°, ê°€ë¡œì„  ë„£ê¸° ë“±
      window.richTextField.document.execCommand(command, false, null);
      this.setFocus();
    },
    execCommandWithArg(command, arg) {
      // ì¸ìê°€ í•„ìš”í•œ ëª…ë ¹ì–´ì¸ ê²½ìš°
      // ex. ì´ë¯¸ì§€ ì‚½ì…ì‹œ ë§í¬
      window.richTextField.document.execCommand(command, false, arg);
      setTimeout(() => {
        this.setFocus();
      }, 10);
    },

    async exportToPDF() {
      let today = new Date();   
      let year = today.getFullYear(); 
      let month = today.getMonth() + 1;  
      let date = today.getDate(); 
      // í˜ì´ì§€ê°€ ìº¡ì³ë˜ê¸° ì „ì— í˜ì´ì§€ ë¶„ì ˆì— ì‚¬ìš©ëœ divë¥¼ ì ì‹œ ìˆ¨ê¹€ ì²˜ë¦¬
      jquery('iframe[name="richTextField"]')
        .contents()
        .find(".html2pdf__page-break")
        .css("visibility", "hidden");
      // html2pdf npm ëª¨ë“ˆ ì‚¬ìš©, ì—ë””í„° ë‚´ìš©ì„ ìº¡ì³í•˜ì—¬ ì´ë¥¼ pdfë¡œ ë³€í™˜í•˜ëŠ” ë°©ì‹
      await html2pdf(
        window.richTextField.document.getElementsByTagName("body")[0],
        {
          margin: 10,
          filename: `${year}_${month}_${date}.pdf`,
          image: { type: "jpeg", quality: 0.98 },
          html2canvas: {
            scale: 2,
            // logging: true,
            // dpi: 192,
            // letterRendering: false,
          },
          jsPDF: {
            unit: "mm",
            format: "a4",
            orientation: "portrait",
            precision: 30,
          },
        }
      );

      // pdf ìƒì„±ì´ ì™„ë£Œë˜ë©´ í˜ì´ì§€ ë¶„ì ˆ í‘œê¸°ê°€ ë‹¤ì‹œ ë³´ì´ë„ë¡ ì„¤ì •
      jquery('iframe[name="richTextField"]')
        .contents()
        .find(".html2pdf__page-break")
        .css("visibility", "visible");
    },
  },
  mounted() {
    // richTextFieldì˜ ë‚´ìš©ì„ ìˆ˜ì •í•  ìˆ˜ ìˆë„ë¡ ë””ìì¸ ëª¨ë“œë¥¼ ì¼œì¤Œ
    window.richTextField.document.designMode = "On";

    // ë¬¸ìê°€ richTextFieldì˜ ë„ˆë¹„ë¥¼ ë„˜ì–´ì„°ì„ ë•Œ ìë™ìœ¼ë¡œ ì¤„ë°”ê¿ˆ
    window.richTextField.document.getElementsByTagName(
      "body"
    )[0].style.wordBreak = "break-all";
    window.richTextField.document.getElementsByTagName("body")[0].style.margin =
      "10px";
    // window.richTextField.document.getElementsByTagName('body')[0].style.pageBreakBefore = "auto"

    // ì´ëª¨í‹°ì½˜ ì„ íƒí•˜ë©´ ì»¤ì„œ ìœ„ì¹˜ì— ì‚½ì…í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ì½”ë“œ
    const picker = new EmojiButton();
    const trigger = document.querySelector("#emoji-trigger");
    picker.on("emoji", (selection) => {
      this.execCommandWithArg("insertHTML", selection.emoji);
    });

    trigger.addEventListener("click", () => picker.togglePicker(trigger));

    // ìŠ¤í¬ë¡¤ ë°œìƒ ê°ì§€í•´ì„œ pageBreak í•¨ìˆ˜ë¡œ ì—°ê²°
    var vm = this;
    jquery('iframe[name="richTextField"]')
      .contents()
      .scroll(function () {
        vm.pageBreak();
      });

    // ë“œë¡­ë‹¤ìš´ì´ ì—´ë ¤ìˆê±°ë‚˜ ëª¨ë‹¬ì´ ì—´ë ¤ìˆëŠ”ë° ë‹¤ë¥¸ ê³³ì„ í´ë¦­í•˜ë©´ ìë™ìœ¼ë¡œ ë‹«íˆë„ë¡ ì„¤ì •
    window.onclick = function (event) {
      if (!event.target.matches(".dropdownButton")) {
        var dropdowns = document.getElementsByClassName("dropdown-content");
        var i;
        for (i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains("show")) {
            openDropdown.classList.remove("show");
          }
        }
      }
      if (event.target == document.getElementById("linkModal")) {
        document.getElementById("linkModal").style.display = "none";
        vm.pageLink = "";
      }
      if (event.target == document.getElementById("imageModal")) {
        document.getElementById("imageModal").style.display = "none";
        vm.imageLink = "";
      }
    };

    window.richTextField.document.onclick = function (event) {
      if (!event.target.matches(".dropdownButton")) {
        var dropdowns = document.getElementsByClassName("dropdown-content");
        var i;
        for (i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains("show")) {
            openDropdown.classList.remove("show");
          }
        }
      }
    };

    // ì—ë””í„° ë‚´ìš©ì´ ë³€ê²½ë ë•Œ emitìœ¼ë¡œ ì „ë‹¬
    jquery('iframe[name="richTextField"]').contents().on('DOMSubtreeModified propertychange', function() {
      const content = window.richTextField.document.getElementsByTagName("body")[0].outerHTML.substring(51).slice(0,-7)
      vm.$emit("updateContent", content)
    });

    // content ë¶ˆëŸ¬ì˜¤ëŠ” ê²½ìš° ì—ë””í„°ì— ì±„ì›Œë„£ê¸°
    window.richTextField.document.getElementsByTagName("body")[0].innerHTML = this.content
  },
};
</script>

<style scoped>
.v-text-field__details {
  display: none !important;
}
.toolBar {
  display: flex;
}
.toolButton {
  margin-right: 2px;
  cursor: pointer;
  background-color: white;
  border: none;
  color: black;
  width: 40px;
  height: 40px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  position: relative;
}
.toolButtonText {
  cursor: pointer;
  background-color: white;
  border: none;
  color: black;
  height: 40px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 14px;
  position: relative;
}
.toolButton:hover {
  background-color: #efefef;
}
.toolButton:hover .tooltip {
  visibility: visible;
}
.tooltip {
  font-size: 13px;
  visibility: hidden;
  width: 70px;
  display: inline;
  background-color: black;
  color: #fff;
  text-align: center;
  padding: 5px 5px 8px 5px;
  border-radius: 6px;
  /* Position the tooltip text - see examples below! */
  position: absolute;
  z-index: 1;
  opacity: 0.8;
  top: 100%;
  left: 50%;
  margin-left: -40px;
}
.tooltip::after {
  content: " ";
  position: absolute;
  bottom: 100%; /* At the top of the tooltip */
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent black transparent;
}

.toolButtonText:hover {
  background-color: #efefef;
}
.toolButtonText:hover .tooltip {
  visibility: visible;
}
.toolButtonText .tooltip {
  font-size: 13px;
  visibility: hidden;
  width: 70px;
  display: inline;
  background-color: black;
  color: #fff;
  text-align: center;
  padding: 5px 5px 8px 5px;
  border-radius: 6px;
  /* Position the tooltip text - see examples below! */
  position: absolute;
  z-index: 1;
  top: 100%;
  opacity: 0.8;
  left: 50%;
  margin-left: -40px;
}
.toolButtonText .tooltip::after {
  content: " ";
  position: absolute;
  bottom: 100%; /* At the top of the tooltip */
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: transparent transparent black transparent;
}
.colorPicker {
  cursor: pointer;
  border: none;
}
.colorPickerButton {
  font-size: 14px;
  display: inline-block;
  padding: 0px 5px;
  color: gray;
  -ms-user-select: none;
  -moz-user-select: -moz-none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  user-select: none;
}
.dropdownButton {
  margin-right: 6px;
  border: 1px solid black;
  border-radius: 3px;
  padding: 5px;
  background-color: white;
  cursor: pointer;
}
.dropdownButton:hover .tooltip {
  visibility: visible;
}
.dropdown {
  position: relative;
  display: inline-block;
}
.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f9f9f9;
  box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
  z-index: 1;
}
.dropdown-content div {
  cursor: pointer;
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
}
.dropdown-content :hover {
  background-color: #f1f1f1;
}
.show {
  display: block;
}
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  padding-top: 100px; /* Location of the box */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0, 0, 0); /* Fallback color */
  background-color: rgba(0, 0, 0, 0.4); /* Black w/ opacity */
}

/* Modal Content */
.modal-content {
  background-color: #fefefe;
  margin: auto;
  padding: 20px;
  border: 1px solid #888;
  width: 400px;
  border-radius: 10px;
}
.modalButton {
  font-weight: bold;
  font-size: 16px;
  width: 100%;
  padding: 7px;
  border: none;
  border-radius: 5px;
  box-shadow: 1px 1px 1px 0.5px #dadce0;
  background-color: #ececec;
}
.modalButton:hover {
  background-color: #dddddd;
}
.modalTextInput {
  width: 99%;
  margin-bottom: 20px;
  padding: 7px 0;
  font-size: 17px;
}
#richTextField {
  overflow-y: hidden;
  height: 500px;
  border: solid #d1d1d1 1px;
  border-radius: 3px;
}
.editorWidth {
  width: 737px;
}
</style>
